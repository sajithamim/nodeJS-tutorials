const http = require('http');
const fs = require('fs');

const server = http.createServer((req, res) => {
    const url = req.url;
    // parse incoming data(payload)
    
    if (url === '/create-post' && req.method === 'POST') {
        // RECEIVE COMING DATA
        const post = [];
        req.on("data", chunk => {
           post.push(chunk)
        }).on('end', function(){
            const parsedData = Buffer.concat(post).toString();
            res.writeHead(200,{"Content-Type": "text/json"})
            console.log(parsedData);
            res.write("Post created successfully");
            res.end();
        })
    }else if (url === '/') {
        // Serve the main page
        res.writeHead(200, { 'Content-Type': 'text/html' });
        res.write('Hello, this is my first server page');
        res.end();
    } else if (url === '/login') {
        // Serve the login page
        fs.readFile('login.html', (err, data) => {
            if (err) {
                console.log(err);
                res.writeHead(404, { 'Content-Type': 'text/html' });
                res.write('File not found');
            } else {
                res.writeHead(200, { 'Content-Type': 'text/html' });
                res.write(data);
            }
            res.end();
        });
    } else if (url === '/register') {
        // Serve the register page
        fs.readFile('register.html', (err, data) => {
            if (err) {
                console.log(err);
                res.writeHead(404, { 'Content-Type': 'text/html' });
                res.write('File not found');
            } else {
                res.writeHead(200, { 'Content-Type': 'text/html' });
                res.write(data);
            }
            res.end();
        });
    } else {
        // Handle other routes or URLs as needed
        res.writeHead(404, { 'Content-Type': 'text/html' });
        res.write('Route not found');
        res.end();
    }
});

server.listen(9000, () => {
    console.log('Server is up and running');
});